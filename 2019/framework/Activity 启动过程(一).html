<!DOCTYPE html><html>

<head>
<meta charset="utf-8">
<title># Activity å¯åŠ¨è¿‡ç¨‹(ä¸€)</title>
<style>
@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff');
}

body {
  background-color: white;
}

.markdown-body {
  min-width: 200px;
  max-width: 760px;
  margin: 0 auto;
  padding: 20px;

  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;;word-wrap: break-word; word-break: break-all;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #fff;
}

.markdown-body .highlight .mf,
.markdown-body .highlight .mh,
.markdown-body .highlight .mi,
.markdown-body .highlight .mo,
.markdown-body .highlight .il,
.markdown-body .highlight .m {
  color: #945277;
}

.markdown-body .highlight .s,
.markdown-body .highlight .sb,
.markdown-body .highlight .sc,
.markdown-body .highlight .sd,
.markdown-body .highlight .s2,
.markdown-body .highlight .se,
.markdown-body .highlight .sh,
.markdown-body .highlight .si,
.markdown-body .highlight .sx,
.markdown-body .highlight .s1 {
  color: #df5000;
}

.markdown-body .highlight .kc,
.markdown-body .highlight .kd,
.markdown-body .highlight .kn,
.markdown-body .highlight .kp,
.markdown-body .highlight .kr,
.markdown-body .highlight .kt,
.markdown-body .highlight .k,
.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #458;
}

.markdown-body .highlight .c,
.markdown-body .highlight .cm,
.markdown-body .highlight .c1 {
  color: #998;
  font-style: italic;
}

.markdown-body .highlight .cp,
.markdown-body .highlight .cs {
  color: #999;
  font-weight: bold;
}

.markdown-body .highlight .cs {
  font-style: italic;
}

.markdown-body .highlight .n {
  color: #333;
}

.markdown-body .highlight .na,
.markdown-body .highlight .nv,
.markdown-body .highlight .vc,
.markdown-body .highlight .vg,
.markdown-body .highlight .vi {
  color: #008080;
}

.markdown-body .highlight .nb {
  color: #0086B3;
}

.markdown-body .highlight .nc {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: #094e99;
}

.markdown-body .highlight .ni {
  color: #800080;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #945277;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555;
}

.markdown-body .highlight .nt {
  color: #000080;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .gd {
  color: #000;
  background-color: #fdd;
}

.markdown-body .highlight .gd .x {
  color: #000;
  background-color: #faa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999;
}

.markdown-body .highlight .gi {
  color: #000;
  background-color: #dfd;
}

.markdown-body .highlight .gi .x {
  color: #000;
  background-color: #afa;
}

.markdown-body .highlight .go {
  color: #888;
}

.markdown-body .highlight .gp {
  color: #555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbb;
}

.markdown-body .highlight .sr {
  color: #017936;
}

.markdown-body .highlight .ss {
  color: #8b467f;
}

.markdown-body .highlight .bp {
  color: #999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}
table td{ word-wrap: break-word !important; word-break: break-all !important; }
/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
  -webkit-text-size-adjust: none;
}

.hljs-comment,
.diff .hljs-header {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.css .rule .hljs-keyword,
.hljs-winutils,
.nginx .hljs-title,
.hljs-subst,
.hljs-request,
.hljs-status {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-hexcolor,
.ruby .hljs-constant {
  color: #008080;
}

.hljs-string,
.hljs-tag .hljs-value,
.hljs-doctag,
.tex .hljs-formula {
  color: #d14;
}

.hljs-title,
.hljs-id,
.scss .hljs-preprocessor {
  color: #900;
  font-weight: bold;
}

.hljs-list .hljs-keyword,
.hljs-subst {
  font-weight: normal;
}

.hljs-class .hljs-title,
.hljs-type,
.vhdl .hljs-literal,
.tex .hljs-command {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-tag .hljs-title,
.hljs-rule .hljs-property,
.django .hljs-tag .hljs-keyword {
  color: #000080;
  font-weight: normal;
}

.hljs-attribute,
.hljs-variable,
.lisp .hljs-body,
.hljs-name {
  color: #008080;
}

.hljs-regexp {
  color: #009926;
}

.hljs-symbol,
.ruby .hljs-symbol .hljs-string,
.lisp .hljs-keyword,
.clojure .hljs-keyword,
.scheme .hljs-keyword,
.tex .hljs-special,
.hljs-prompt {
  color: #990073;
}

.hljs-built_in {
  color: #0086b3;
}

.hljs-preprocessor,
.hljs-pragma,
.hljs-pi,
.hljs-doctype,
.hljs-shebang,
.hljs-cdata {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.diff .hljs-change {
  background: #0086b3;
}

.hljs-chunk {
  color: #aaa;
}


</style>

<style> @media print{ .hljs{overflow: visible; word-wrap: break-word !important;} }</style></head><body><div class="markdown-body">
<h1 id="toc_0">Activity å¯åŠ¨è¿‡ç¨‹(ä¸€)</h1>

<p>è¿™é‡Œè®²çš„æ˜¯ä¸€ä¸ªActivityå¯åŠ¨å¦ä¸€ä¸ªActivityçš„è¿‡ç¨‹ã€‚<br/>
é¦–å…ˆæˆ‘ä»¬åœ¨activity.startActivity(),ç‚¹è¿›å»æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹</p>

<p><img src="media/15486766374750/15486772761818.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15486772908727.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15486773071393.jpg" alt=""/>ï¿¼</p>

<p>åœ¨Activityä¸­æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨startActivityForResult(),åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åˆè°ƒç”¨mInstrumentation.execStartActivity()ã€‚</p>

<p><img src="media/15486766374750/15486776690721.jpg" alt=""/>ï¿¼</p>

<p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œè°ƒç”¨äº†ActivityManager.getService().startActivity(),æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹getService()ä¼šè¿”å›ä»€ä¹ˆå¯¹è±¡ã€‚</p>

<p><img src="media/15486766374750/15486778672837.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15486778856899.jpg" alt=""/>ï¿¼</p>

<p>getService() åªæ˜¯è°ƒç”¨äº†IActivityManagerSingleton.get()ã€‚è€ŒIActivityManagerSingletonåˆ™æ˜¯ä¸€ä¸ªSingletonçš„å®ä¾‹ã€‚<br/>
Singletonçš„ä»£ç å¦‚ä¸‹ï¼š<br/>
<img src="media/15486766374750/15486779802660.jpg" alt=""/>ï¿¼</p>

<p>ä»Singletonå¯ä»¥çœ‹åˆ°ï¼ŒIActivityManagerSingleton.get()åœ¨ç¬¬ä¸€æ¬¡çš„æ—¶å€™ä¼šè°ƒç”¨create()ï¼Œè€Œè¿™ä¸ªIActivityManagerSingleton çš„create() æ­£æ˜¯çš„å‰é¢çœ‹åˆ°çš„è¿™ä¸ªæ–¹æ³•ï¼š<br/>
<img src="media/15486766374750/15486778856899.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œå°†é€šè¿‡IActivityManager.Stub.asInterface(b)è¿”å›ä¸€ä¸ªIActivityManagerå¯¹è±¡å®ä¾‹ã€‚å› æ­¤IActivityManagerSingleton.get()ä¹Ÿå°†è¿”å›ä¸€ä¸ªIActivityManagerå¯¹è±¡å®ä¾‹ã€‚</p>

<p>å› ä¸ºç¬”è€…è¿™é‡Œçœ‹çš„æ˜¯26çš„æºç ï¼Œ26ä¸­å¢åŠ äº†IActivityManager.aidlæ–‡ä»¶ï¼Œè¿™éƒ¨åˆ†ä»£ç éœ€è¦åœ¨<a href="http://androidxref.com/8.0.0_r4/xref/frameworks/base/core/java/android/app/IActivityManager.aidl">AndroidXrefä¸­çš„IActivityManager.aidl</a>ä¸­æŸ¥çœ‹ï¼Œéƒ¨åˆ†å®šä¹‰å¦‚ä¸‹ï¼š<br/>
<img src="media/15486766374750/15486787413207.jpg" alt=""/>ï¿¼</p>

<p>æˆ‘ä»¬åœ¨ä½¿ç”¨aidlçš„æ—¶å€™ï¼ŒASéƒ½ä¼šå¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªStubå’Œæœ¬åœ°çš„ä»£ç†å¯¹è±¡ã€‚IActivityManagerä¹Ÿä¼šå¯¹åº”ç”Ÿæˆä¸€ä¸ªIActivityManager.Stubç±»ï¼Œä¸”å®ƒæœ‰ä¸ªå­ç±»ä¸ºActivityManagerService <br/>
<img src="media/15486766374750/15486794120831.jpg" alt=""/>ï¿¼</p>

<p>è€Œæˆ‘ä»¬ä¹‹å‰IActivityManagerSingleton.get()å–å¾—çš„å°±æ˜¯ä¸€ä¸ªActivityManagerServiceæˆ–è€…æ˜¯ActivityManagerServiceçš„ä¸€ä¸ªä»£ç†ã€‚</p>

<blockquote>
<p>æ³¨ï¼šè¿™ä¸€éƒ¨åˆ†å…·ä½“å‚è€ƒä¸‹Binderçš„å®šä¹‰åŠä½¿ç”¨ã€‚å¦å¤–æˆ‘è¿˜æ²¡æœ‰è¯´æ˜å¦‚ä½•èƒ½æ‰¾åˆ°ActivityManagerServiceï¼Œè¿™ä¸€éƒ¨åˆ†éƒ½æ˜¯å‚è€ƒå…¶ä»–æ–‡ç« æ‰€å¾—ï¼Œå…·ä½“å¦‚ä½•é€šè¿‡IActivityManager.aidlå®šä½åˆ°è¿™ä¸ªç±»çš„ï¼Œè¿˜éœ€è¦å†æ‹ä¸€æ‹ã€‚</p>
</blockquote>

<p>ç°åœ¨æˆ‘ä»¬å›åˆ°Instrumentation<br/>
<img src="media/15486766374750/15486797142078.jpg" alt=""/>ï¿¼</p>

<p>ActivityManager.getService() å³è¿”å›ä¸€ä¸ªActivityManagerServiceæˆ–è€…å…¶ä»£ç†å¯¹è±¡ã€‚æ‰€ä»¥è¿™é‡Œæœ€ç»ˆå°±æ˜¯è°ƒç”¨äº†ActivityManagerService.startActivity()<br/>
<br/><br/>
<strong>å°ç»“ä¸€ï¼š</strong><br/>
è¿™é‡Œä½¿ç”¨ç®€å•çš„æ—¶åºå›¾æ¥è¯´æ˜æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ã€‚è¿™é‡Œçš„AMSå³æ—¶ActivityManagerServiceçš„ç¼©å†™ï¼Œä¹‹åè¯»å°†é‡‡ç”¨è¿™ä¸ªç¼©å†™æ¥ä»£ç ActivityManagerService.</p>

<p><img src="media/15486766374750/15486811350826.jpg" alt=""/>ï¿¼</p>

<p><br/><br/>
<br/><br/>
æˆ‘ä»¬é€šè¿‡å‰é¢æ–¹æ³•çš„æŸ¥æ‰¾ï¼Œå·²ç»çŸ¥é“å¯åŠ¨ä¸€ä¸ªActivityä¹‹åï¼Œæœ€ç»ˆä¼šè°ƒç”¨ç³»ç»Ÿçš„ActivityManagerService.startActivity(),æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹è¿™ä¸ªæ–¹æ³•åˆåšäº†å“ªäº›æ“ä½œã€‚</p>

<p><img src="media/15486766374750/15486816418828.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15486816757171.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œæœ€åè°ƒç”¨äº†mActivityStarter.startActivityMayWait(),è¿™æ ·å°±å°†è°ƒç”¨è¿‡ç¨‹è½¬äº¤ç»™äº†ActivityStarterç±»ã€‚</p>

<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸€å¥è¯ï¼Œè¿™ä¸»è¦æ˜¯åœ¨æ”¶é›†ç›®æ ‡Activityçš„ä¿¡æ¯ï¼Œå°†ä¿¡æ¯å­˜å‚¨åœ¨ActivityInfoä¸­ã€‚<br/>
<img src="media/15486766374750/15486819210213.jpg" alt=""/>ï¿¼</p>

<p>ä¹‹ååˆè°ƒç”¨äº†æœ¬ç±»ä¸­çš„startActivityLocked()ï¼Œå¦‚ä¸‹ï¼š<br/>
<img src="media/15486766374750/15486819855403.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15486820892862.jpg" alt=""/>ï¿¼</p>

<p>åœ¨è¿™é‡Œæ ¡éªŒäº†è°ƒç”¨æ–¹æ³•çš„åŸå› ã€‚ç„¶åè°ƒç”¨äº†ActivityStarterä¸­çš„startActivity()ã€‚<br/>
<img src="media/15486766374750/15486822330110.jpg" alt=""/>ï¿¼</p>

<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¸»è¦åšäº†ä¸€äº›æ ¡éªŒï¼ŒåŒ…æ‹¬ï¼šæƒé™æ ¡éªŒã€componentæ ¡éªŒã€ç›®æ ‡activityä¿¡æ¯æ ¡éªŒç­‰ã€‚åŒæ—¶åˆ›å»ºä¸€ä¸ªActivityRecordå¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾è¿™äº›æ ¡éªŒè¿‡åçš„æ•°æ®ï¼š<br/>
<img src="media/15486766374750/15486827320180.jpg" alt=""/>ï¿¼</p>

<p>ç„¶åç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªstartActivity()<br/>
<img src="media/15486766374750/15486827457382.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15486827875618.jpg" alt=""/>ï¿¼</p>

<p>åœ¨è¿™ä¸ªstartActivity()ä¸­å°†è°ƒç”¨ActivityStarterçš„startActivityUnchecked()ï¼ŒstartActivityUnchecked()æ–¹æ³•æŒºé•¿ï¼Œä¸»è¦æ˜¯activityæ ˆçš„å¤„ç†ï¼Œæ¯”å¦‚æ˜¯å¦åœ¨æ ˆé¡¶ã€æ˜¯å¦éœ€è¦æ–°å»ºä¸€ä¸ªæ ˆã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†è°ƒç”¨mSupervisor.resumeFocusedStackTopActivityLocked().</p>

<p>è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ<br/>
é¦–å…ˆæˆ‘ä»¬å›åˆ°è¿™é‡Œ<br/>
<img src="media/15486766374750/15486827457382.jpg" alt=""/>ï¿¼</p>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬å…­ä¸ªå‚æ•°è®¾ç½®ä¸ºtrueï¼Œè€Œè¿™ä¸ªtrueå°†ä¸€ç›´è·Ÿç€æˆ‘ä»¬çš„æ–¹æ³•ä¼ é€’ä¸‹å»ï¼Œç›´åˆ°startActivityUncheckedè°ƒç”¨äº†setInitialState()ä¹‹åå°†è¿™ä¸ªtrueèµ‹ç»™äº†ActivityStarterä¸­çš„mDoResumeå±æ€§ã€‚</p>

<p><img src="media/15486766374750/15486841490088.jpg" alt=""/>ï¿¼<br/>
å› æ­¤ï¼Œæœ€åæˆ‘ä»¬å°†èµ°å…¥è¿™ä¸ªä»£ç å—ã€‚<br/>
è¿™é‡Œä¸¤æ®µè‹±æ–‡ï¼Œå°è¯•ç€ç¿»è¯‘ä¸€ä¸‹ï¼š</p>

<blockquote>
<p>If the activity is not focusable, we can&#39;t resume it, but still would like to make sure it becomes visible as it starts (this will also trigger entry animation). An example of this are PIP activities.Also, we don&#39;t want to resume activities in a task that currently has an overlay as the starting activity just needs to be in the visible paused state until the over is removed.<br/>
å¦‚æœActivityä¸å¯èšç„¦ï¼Œå°±ä¸èƒ½é‡å¯å®ƒï¼Œä¸è¿‡æˆ‘ä»¬ä»å¯ä¿è¯å½“å®ƒå¯åŠ¨çš„æ—¶å€™æ˜¯å¯è§çš„ã€‚æ¯”å¦‚PIPçš„æ´»åŠ¨ã€‚æˆ‘ä»¬ä¸æƒ³é‡å¯ä¸€ä¸ªå¯è¦†ç›–ä»»åŠ¡ä¸­çš„activitiesï¼Œå› ä¸ºå¼€å§‹çš„æ´»åŠ¨åªéœ€è¦å¤„äºå¯è§çš„æš‚åœçŠ¶æ€ï¼Œç›´åˆ°ç§»é™¤è¦†ç›–ã€‚</p>

<p>If the target stack was not previously focusable (previous top running activity on that stack was not visible) then any prior calls to move the stack to the will not update the focused stack.  If starting the new activity now allows the task stack to be focusable, then ensure that we now update the focused stack accordingly.<br/>
å¦‚æœç›®æ ‡æ ˆä¹‹å‰ä¸å¯è·å–ç„¦ç‚¹ï¼ˆä¹‹å‰é¡¶å±‚çš„activityä¸å¯è§ï¼‰ï¼Œé‚£ä¹ˆå°†è¯¥æ ˆç§»åŠ¨åˆ°ä¸ä¼šæ›´æ–°çš„ç„¦ç‚¹æ ˆä¸­ã€‚å¦‚æœç°åœ¨æ˜¯æ–°å»ºä¸€ä¸ªactivityï¼Œå°±å…è®¸ä»»åŠ¡æ ˆæ˜¯å¯ä»¥è·å–ç„¦ç‚¹çš„ï¼Œç„¶åç¡®ä¿æˆ‘ä»¬ç°åœ¨åœ¨æ›´æ–°ç›¸å…³çš„ç„¦ç‚¹æ ˆã€‚</p>

<p>(è‹±æ–‡å¤ªçƒ‚ï¼Œè‡ªå·±éƒ½ä¸ç†è§£ç¿»è¯‘å‡ºæ¥çš„æ˜¯ä»€ä¹ˆğŸ‘» -_-! )</p>
</blockquote>

<p>æ ¹æ®ä¸Šé¢ä¸¤æ®µæ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™é‡Œä¼šè°ƒç”¨mSupervisor.resumeFocusedStackTopActivityLocked(),è¿™é‡Œçš„mSuperVisorå¯¹åº”çš„æ˜¯ActivityStackSupervisorç±»ã€‚æ¥ç€ç»§ç»­çœ‹ä¸‹å»ï¼š</p>

<p><img src="media/15486766374750/15486861634048.jpg" alt=""/>ï¿¼</p>

<p>æˆ‘ä»¬åœ¨ä¹‹å‰å·²ç»æ„é€ å‡ºä¸€ä¸ªActivityRecord,æ‰€ä»¥è¿™é‡Œä¼šè°ƒç”¨mFocusedStack.resumeTopActivityUncheckedLocked().å…¶ä¸­mFocuseStackæ˜¯ActivityStackçš„ä¸€ä¸ªå®ä¾‹ã€‚<br/>
<img src="media/15486766374750/15486862880125.jpg" alt=""/>ï¿¼</p>

<p>åœ¨resumeTopActivityInnerLocked()ä¸­å°†è°ƒç”¨<br/>
<img src="media/15486766374750/15486865513070.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œåˆå°†è°ƒç”¨è¿‡ç¨‹äº¤ç»™äº†ActivityStackSupervisorã€‚</p>

<p><img src="media/15486766374750/15486866052523.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œå°†è°ƒç”¨realStartActivityLocked()</p>

<p><img src="media/15486766374750/15486866431895.jpg" alt=""/>ï¿¼</p>

<p>realStartActivityLocked()åˆè°ƒç”¨äº†app.thread.scheduleLaunchActivity()ï¼Œè¿™ä¸ªapp.threadå°±æ˜¯å®¢æˆ·ç«¯è°ƒç”¨ç³»ç»ŸAMSæ—¶ä¼ é€’è¿‡æ¥çš„ActivityThreadå¯¹è±¡ï¼Œå› æ­¤è¿™é‡Œå°±æ˜¯åœ¨è°ƒç”¨å®¢æˆ·ç«¯çš„ActivityThread.scheduleLaunchActivity()</p>

<blockquote>
<p>è¿™é‡Œå®¢æˆ·ç«¯æŒ‡çš„å°±æ˜¯å½“å‰çš„appè¿›ç¨‹ï¼Œè€ŒæœåŠ¡ç«¯æŒ‡çš„å°±æ˜¯Androidç³»ç»ŸæœåŠ¡è¿›ç¨‹,å¯å‚çœ‹SystemServerç±»ã€‚ä¹‹åä¹Ÿå°†ä¼šç»§ç»­æ²¿ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿™æ ·çš„æ¦‚å¿µã€‚</p>
</blockquote>

<p><strong>å°ç»“äºŒï¼š</strong><br/>
<img src="media/15486766374750/15486879854107.jpg" alt=""/>ï¿¼</p>

<p><br/><br/>
å‰é¢ä¸€ä¸ªå°ç»“ç»“æŸä¹‹åï¼Œæˆ‘ä»¬å·²ç»å°†è°ƒç”¨è¿‡ç¨‹ä»ç³»ç»ŸæœåŠ¡å›è°ƒåˆ°äº†å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±æ¥ç€çœ‹å®¢æˆ·ç«¯åšäº†å“ªäº›æ“ä½œã€‚</p>

<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ActivityThread.scheduleLaunchActivity()</p>

<p><img src="media/15486766374750/15487254546912.jpg" alt=""/>ï¿¼</p>

<p>è¿™ä¸ªæ–¹æ³•ä¸­ä¸»è¦æ˜¯å°†AMSä¼ é€’è¿‡æ¥çš„å‚æ•°å°è£…åˆ°ActivityClientRecordçš„å®ä¾‹ä¸­ï¼Œå¹¶å°†è¿™ä¸ªActivityClientRecordå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰å¾…æ¶ˆæ¯çš„å¤„ç†ã€‚</p>

<p><img src="media/15486766374750/15487255560742.jpg" alt=""/>ï¿¼</p>

<p>æŸ¥çœ‹sendMessage()æ–¹æ³•ï¼Œå¯ä»¥ç¡®å®šæ¶ˆæ¯æ˜¯é€šè¿‡mHæ¥å‘é€çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹mHçš„å®šä¹‰ã€‚<br/>
<img src="media/15486766374750/15487256540735.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15487256701988.jpg" alt=""/>ï¿¼</p>

<p>æœ‰å®šä¹‰å†…å®¹å¯ä»¥çŸ¥é“mHå°±æ˜¯ä¸€ä¸ªHandlerã€‚<br/>
ç”±ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“ActivityThread.scheduleLaunchActivity()ä¸­å‘å‡ºçš„æ˜¯ä¸€ä¸ªLAUNCH_ACTIVITYæ¶ˆæ¯ï¼Œæˆ‘ä»¬çœ‹çœ‹æ¥æ”¶å¤„çš„ä»£ç ã€‚</p>

<p><img src="media/15486766374750/15487257764437.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œç›´æ¥è°ƒç”¨handleLaunchActivity() æ¥å¤„ç†ActivityClientRecord ï¼Œç»§ç»­æŸ¥çœ‹è¿™ä¸ªæ–¹æ³•<br/>
<img src="media/15486766374750/15487258434872.jpg" alt=""/>ï¿¼</p>

<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„æ–¹æ³•åç§°ï¼Œä¸€ä¸ªperformLaunchActivity()ï¼Œä¸€ä¸ªæ˜¯handleResumeActivity()ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹performLaunchActivity()ï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œå†…å®¹ä¹Ÿæ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ç»†åˆ†å‡ æ®µæ¥æŸ¥çœ‹ã€‚</p>

<p>ç¬¬ä¸€æ®µï¼š<br/>
<img src="media/15486766374750/15487261316606.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œä¸»è¦é€šè¿‡AMSä¼ é€’è¿‡æ¥çš„ActivityClientRecordè¿›è¡ŒåŒ…ä¿¡æ¯å’ŒComponentNameä¿¡æ¯çš„æ„å»ºã€‚åŒæ—¶è¿™ä¸ªæœ‰ä¸ªcreateBaseContextForActivity()<br/>
<img src="media/15486766374750/15487263361245.jpg" alt=""/>ï¿¼</p>

<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†åˆ›å»ºContextImplå¯¹è±¡ã€‚<br/>
ç”±æ­¤å¯åˆ°è¿™ä¸€æ®µä¸»è¦æ˜¯åˆ›å»ºActivityä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>

<p>ç¬¬äºŒæ®µï¼š<br/>
<img src="media/15486766374750/15487264746227.jpg" alt=""/>ï¿¼</p>

<p>mInstrumentation.newActivity() å¦‚ä¸‹ï¼š<br/>
<img src="media/15486766374750/15487266082203.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œé€šè¿‡åå°„åˆ›å»ºäº†ä¸€ä¸ªActivityå®ä¾‹ã€‚</p>

<p>ç¬¬ä¸‰æ®µï¼š</p>

<p><img src="media/15486766374750/15487267001597.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œåªæ˜¯åˆ›å»ºä¸€ä¸ªApplicatioçš„å®ä¾‹ã€‚<br/>
<img src="media/15486766374750/15487269199465.jpg" alt=""/>ï¿¼</p>

<p>ä»£ç 1åˆ¤æ–­ï¼Œapplicationå¯¹è±¡å·²ç»åˆ›å»ºï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„applicationå¯ä»¥ä¿æŒä¸ºä¸€ä¸ªå•ä¾‹çš„åŸå› ã€‚<br/>
ä»£ç 2åˆ™æ˜¯åˆ›å»ºäº†Applicationæ‰€éœ€çš„ä¸Šä¸‹æ–‡ContextImplå®ä¾‹ï¼ŒåŒæ—¶è°ƒç”¨Instrumentation.newApplication()åˆ›å»ºäº†Applicationå®ä¾‹ã€‚<br/>
<img src="media/15486766374750/15487270600482.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒApplicationä¹Ÿæ˜¯é€šè¿‡åå°„æ¥åˆ›å»ºçš„ã€‚åˆ›å»ºå®Œæˆä¹‹åç«‹å³è°ƒç”¨äº†Application.attach(),attach()ä¸­å°†ç»§ç»­è°ƒç”¨attachBaseContext()</p>

<p><img src="media/15486766374750/15487272158696.jpg" alt=""/>ï¿¼</p>

<p>å›åˆ°å…¥å£æ–¹æ³•makeApplication(),ç»§ç»­å¾€ä¸‹çœ‹ã€‚<br/>
<img src="media/15486766374750/15487273174539.jpg" alt=""/>ï¿¼</p>

<p>instrumentation.callApplicationOnCreate(app)</p>

<p><img src="media/15486766374750/15487273771032.jpg" alt=""/>ï¿¼</p>

<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å°†applicationçš„åˆ›å»ºè¿‡ç¨‹ä¹Ÿçœ‹å®Œäº†ã€‚æ‰€ä»¥ç¬¬å››æ®µåªæ˜¯åˆ›å»ºApplicationå®ä¾‹.</p>

<p>ç¬¬å››æ®µ</p>

<p><img src="media/15486766374750/15487275709948.jpg" alt=""/>ï¿¼</p>

<p>ä»£ç 1å°±æ˜¯è°ƒç”¨äº†Activity.attach()ã€‚Activity.attach() ä¸»è¦æ˜¯åˆ›å»ºWindowä¿¡æ¯ã€‚<br/>
ä»£ç 2ç‚¹è¿›å»ï¼Œå…¶å®å°±åœ¨è°ƒç”¨Activity.performCreate(),è€ŒperformCreate()å°†è°ƒç”¨onCreate()ã€‚<br/>
<img src="media/15486766374750/15487276231544.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15487277510425.jpg" alt=""/>ï¿¼</p>

<p><strong>å°å°ç»“ï¼š</strong><br/>
ç¬¬ä¸€æ®µï¼šåˆ›å»ºActivityä¸Šä¸‹æ–‡</p>

<p>ç¬¬äºŒæ®µï¼šåˆ©ç”¨åå°„åˆ›å»ºActivity</p>

<p>ç¬¬ä¸‰æ®µï¼šè·å–Applicationå®ä¾‹ã€‚å¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥æ–¹æ³•ï¼Œå¦‚æœæœªåˆ›å»ºåˆ™åˆ©ç”¨åå°„åˆ›å»ºApplicationå®ä¾‹ï¼Œå¹¶è°ƒå®ƒçš„attachï¼ŒonCreateç­‰æ–¹æ³•</p>

<p>ç¬¬å››æ®µï¼šè°ƒç”¨Activityçš„attachå’ŒonCreateã€‚å€¼å¾—ä¸€æçš„æ˜¯attach() ä¸­å°†åˆ›å»ºwindowä¿¡æ¯ã€‚</p>

<p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬å·²ç»æ˜ç™½äº†ä¸€ä¸ªæ–°Activityçš„åˆ›å»ºè¿‡ç¨‹ï¼Œä½†æ˜¯å®ƒæ˜¯æ€ä¹ˆä½œä¸ºä¸€ä¸ªç•Œé¢æ˜¾ç¤ºå‡ºæ¥çš„å‘¢ï¼Ÿè¿™éƒ¨åˆ†å†…å®¹å’ŒWindowManagerService(ç®€ç§°WMS)ç›¸å…³ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸è®¨è®ºã€‚ä»¥å¾€æˆ‘ä»¬å¸¸è¯´ï¼ŒActivityåœ¨onResumeä¹‹åæ‰æ˜¯å¯è§çš„ã€‚é‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±æ¥æ‰¾æ‰¾è¿™ä¸ªè¯´æ³•çš„ç­”æ¡ˆã€‚</p>

<p>ä¸Šæ–‡ä¸­çš„handleLaunchActivity(),é™¤äº†performLaunchActivity(),æˆ‘ä»¬è¿˜æåˆ°äº†handleResumeActivity(),æ¥ä¸‹æ¥å°±ç‚¹å‡»å»çœ‹çœ‹ï¼Œè¿™ä¸ªæ–¹æ³•åˆåšäº†å“ªäº›æ“ä½œã€‚</p>

<p><img src="media/15486766374750/15487286148072.jpg" alt=""/>ï¿¼</p>

<p>handleResumeActivity() è°ƒç”¨äº†actiivty.performResume()<br/>
<img src="media/15486766374750/15487286377997.jpg" alt=""/>ï¿¼</p>

<p>åœ¨performResume()ä¸­ï¼Œæ³¨æ„çº¢æ¡†å†…å®¹ï¼Œè¿™é‡Œåˆ†åˆ«è°ƒç”¨äº†performRestart() å’ŒmInstrumentation.callActivityOnResume() åˆ†åˆ«å¯¹åº”çš„Activity.onStart()ã€Activity.reStart()å’ŒActivity.onResume().å…·ä½“è°ƒç”¨è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å†æè¿°äº†ã€‚<br/>
<img src="media/15486766374750/15487289974956.jpg" alt=""/>ï¿¼</p>

<p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿçœ‹å®Œäº†activity.onResumeçš„è°ƒç”¨è¿‡ç¨‹ã€‚ä½†å¹¶æ²¡æœ‰æ‰¾åˆ°åˆ°ç•Œé¢æ˜¾ç¤ºæ—¶æœºã€‚æˆ‘ä»¬å›åˆ°handleResumeActivity()å¹¶ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p>

<p><img src="media/15486766374750/15487296112064.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œä¸»è¦ç†è§£ä¸‹æ³¨é‡Šï¼šå¦‚æœå½“å‰Activityçš„windowæœªæ·»åŠ åˆ°WindowManagerï¼Œè¿™ä¸ªactivityå°±ä¸å¯ä»¥å…³é—­æˆ–æ‰“å¼€æ–°çš„activityã€‚</p>

<p><img src="media/15486766374750/15487298313638.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œå…ˆæ˜¯å°†decorè®¾ç½®ä¸ºä¸å¯è§ï¼Œç„¶åå°†decoræ·»åŠ åˆ°WindowManagerä¸­ã€‚</p>

<p><img src="media/15486766374750/15487299092909.jpg" alt=""/>ï¿¼</p>

<p><img src="media/15486766374750/15487299393419.jpg" alt=""/>ï¿¼</p>

<p>è¿™é‡Œåˆè°ƒç”¨äº†ä¸€æ¬¡mDecor.setVisibility(View.VISIBLE)å°†decorviewè®¾ç½®ä¸ºå¯è§äº†ã€‚</p>

<p>çœ‹åˆ°è¿™ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾åˆ°äº†Activityä¸ºä»€ä¹ˆæ˜¯åœ¨onResumeä¹‹åæ‰æ˜¯å¯è§çš„ã€‚</p>

<p><strong>å°ç»“ï¼š</strong></p>

<ol>
<li><p>scheduleLaunchActivity()ä¹‹åï¼Œé€šè¿‡Handler.sendMessage()å°†çº¿ç¨‹åˆ‡æ¢å›ä¸»çº¿ç¨‹ï¼ŒåŒæ—¶åœ¨ä¸»çº¿ç¨‹ä¸­å¹¶è°ƒç”¨handleLaunchActivity()ã€‚è€ŒhandleLaunchActivity()æ–¹æ³•ä¸­åˆå°†è°ƒç”¨performLaunchActivity()å’ŒhandleResumeActivity()ã€‚</p>

<p>è¿™ä¸ªå°ç‚¹å³æ˜¯scheduleLaunchActivityä¹‹åçš„è°ƒç”¨è¿‡ç¨‹ï¼Œæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™é‡Œå°±ä¸å†ç»˜åˆ¶æ—¶åºå›¾äº†ã€‚</p></li>
<li><p>performLaunchActivity() ä¸»è¦åˆ†ä¸ºå››ä¸ªç‰‡æ®µ<br/>
2.1 åˆ›å»ºActivityä¸Šä¸‹æ–‡ContextImpl<br/>
2.2 åˆ©ç”¨åå°„åˆ›å»ºActivity<br/>
2.3 è·å–Applicationå®ä¾‹ã€‚å¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœæœªåˆ›å»ºåˆ™åˆ©ç”¨åå°„åˆ›å»ºApplicationå®ä¾‹ï¼Œå¹¶è°ƒå®ƒçš„attachï¼ŒonCreateç­‰æ–¹æ³•<br/>
2.4 è°ƒç”¨Activityçš„attachå’ŒonCreateã€‚å€¼å¾—ä¸€æçš„æ˜¯attach() ä¸­å°†åˆ›å»ºwindowä¿¡æ¯ã€‚</p></li>
<li><p>handleResumeActivity <br/>
3.1 è°ƒç”¨onstartï¼ŒonReStartï¼ŒonResumeç­‰æ–¹æ³•<br/>
3.2 å°†decorviewè®¾ç½®ä¸ºä¸å¯è§ï¼Œç„¶åå°†viewæ·»åŠ åˆ°windowmanager<br/>
3.3 å°†decorviewè®¾ç½®ä¸ºå¯è§</p></li>
</ol>

<p><br/><br/>
ä»¥ä¸Šï¼Œä¸€ä¸ªActivityå¯åŠ¨å¦ä¸€ä¸ªActivityçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±ç®—æ˜¯çœ‹å®Œäº†ã€‚è¿™é‡Œä¸»è¦å°†å…¶åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ã€‚</p>

<ol>
<li>å®¢æˆ·ç«¯Activityé€šè¿‡Instrumentationè·å–AMSï¼Œå¹¶ä»£ç”¨AMSçš„startActivity()</li>
<li>AMSä¸­å®Œæˆæƒé™æ ¡éªŒã€Activityæ ˆå¤„ç†ã€ç›®æ ‡Activityä¿¡æ¯æ„å»ºï¼Œç„¶åé€šè¿‡ActivityThread.scheduleLaunchActivityå›è°ƒåˆ°å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯é€šè¿‡handlerå°†çº¿ç¨‹åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼Œç„¶ååœ¨handleLaunchActivity() ä¸­å®Œæˆactivityçš„åˆ›å»ºå’Œæ˜¾ç¤ºã€‚</li>
</ol>

</div></body>

</html>
